<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Adaptive Framework: afw command &ndash;local</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Adaptive Framework
   &#160;<span id="projectnumber">0.9.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">afw command &ndash;local </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The &ndash;local parameter causes the afw command to act somewhat like a single thread AFW server.</p>
<p>One use of this is to run "afw --local 1" from a program. This causes the response output from afw local mode to be sent to stdout (fd 1), which can then be piped to the the program for processing.</p>
<h1><a class="anchor" id="autotoc_md54"></a>
afw command –local input and output segments</h1>
<p>Input is read from stdin as a series of input segments and output is written to the specified file descriptor as a series of output segments.</p>
<p>Anything written to stderr is not structured and is not written as segments.</p>
<p>Each segment consists of one or more chunks, each beginning with a length followed by a newline (character: <br  />
, Unicode: U+000A, ASCII: 10, hex: 0x0a). This length is the number of octets in the Unicode UTF-8 encoded string that follows. The last chunk of a segment must be "0\n".</p>
<p>The final segment written to the input stream must be 4\nexit0<br  />
.</p>
<p>Example:</p>
<div class="fragment"><div class="line">14\n&quot;Hello World!&quot;0\n</div>
</div><!-- fragment --><p>which produces the same "Hello World!" result as:</p>
<div class="fragment"><div class="line">6\n&quot;Hello8\n World!&quot;0\n</div>
</div><!-- fragment --><p>Each input segment that begins with <code>++afw-local-</code> is a directive for afw &ndash;local processing. All other segments are requests.</p>
<p>An output segment is produced for each input segment and is the JSON UTF-8 encoding _AdaptiveResponse_ object except when directive <code>++afw-local-mode-http-like</code> is active.</p>
<h1><a class="anchor" id="autotoc_md55"></a>
afw –local directives</h1>
<p>If no directives are encountered, <code>++afw-local-mode-evaluate-direct</code> is implied with "accept": "application/json" and "syntax" set to the &ndash;syntax specified on the afw command or the default of expression.</p>
<p>Directives start with <code>++afw-local-</code> followed with a name and optionally followed with a colon (':') and input for the directive.</p>
<h2><a class="anchor" id="autotoc_md56"></a>
++afw-local-mode-*</h2>
<p>Directives beginning with <code>++afw-local-mode-</code> and followed with <code>action</code>, <code>action-direct</code>, <code>evaluate</code>, <code>evaluate-direct</code>, or <code>http-like</code>, determine how requests are processed. Each time one of these directives is encountered it replaces the effects of the previous one.</p>
<h3><a class="anchor" id="autotoc_md57"></a>
++afw-local-mode-action and ++afw-local-mode-action-direct</h3>
<p>Directive <code>++afw-local-mode-action</code> and <code>++afw-local-mode-action-direct</code> indicates that the request contains an _AdaptiveAction_ object in the current <code>CONTENT-TYPE</code>.</p>
<p>For <code>++afw-local-mode-action-direct</code>, this object is passed directly to <code><a class="el" href="afw__action_8c.html#a7eb0f23136342f509fccb4326f10fd2f" title="Perform actions(s) specified in AdaptiveActions object.">afw_action_perform()</a></code> without going through normal server request process. If you need accept content type <code>application/x-afw</code> or other request processing to occur, use <code>++afw-local-mode-action</code> which issues a POST /afw to an HTTP-like local server implementation.</p>
<p>This directive can be optionally followed immediately by a colon (':') and an object in relaxed JSON syntax that has optional property "accept".</p>
<p>These properties are set in the request properties object.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Property   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ACCEPT</code>   </td><td class="markdownTableBodyNone">This is the media-type to use for output. The default is <code>application/json</code>. Content type <code>application/x-afw"</code>is not supported by <code>++afw-local-mode-action-direct</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CONTENT-TYPE</code>   </td><td class="markdownTableBodyNone">This is the media-type to use for the input <code>_AdaptiveAction_</code> object. The default is <code>application/json</code>. Content type <code>application/x-afw</code> is not supported by <code>++afw-local-mode-action-direct</code>.   </td></tr>
</table>
<p>Example:</p>
<div class="fragment"><div class="line">++afw-local-mode-action:</div>
<div class="line">{</div>
<div class="line">    &quot;ACCEPT&quot;: &quot;application/xml&quot;   // Use media-type &quot;application/xml&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md58"></a>
++afw-local-mode-evaluate and ++afw-local-mode-evaluate-direct</h3>
<p>Directive <code>++afw-local-mode-evaluate</code> and <code>++afw-local-mode-evaluate-direct</code> indicates that an _AdaptiveAction_ object is created with the execute function for the associated syntax as the "function" property and a "source" property with the body of the request.</p>
<p>For <code>++afw-local-mode-evaluate-direct</code>, this object is passed directly to <code><a class="el" href="afw__action_8c.html#a7eb0f23136342f509fccb4326f10fd2f" title="Perform actions(s) specified in AdaptiveActions object.">afw_action_perform()</a></code> without going through normal server request process. If you need accept content type <code>application/x-afw</code> or other request processing to occur, use <code>++afw-local-mode-evaluate</code> which issues a POST /afw to an HTTP-like local server implementation.</p>
<p>This directive can be optionally followed immediately by a colon (':') and an object in relaxed JSON syntax that has optional properties "syntax" and "accept".</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Property   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>syntax</code>   </td><td class="markdownTableBodyNone">This is the syntax of the request. The default is the &ndash;syntax value specified on the afw command which default to expression.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ACCEPT</code>   </td><td class="markdownTableBodyNone">This is the media-type to use for output. The default is application/json. Content type <code>application/x-afw</code> is not supported by <code>++afw-local-mode-evaluate-direct</code>.   </td></tr>
</table>
<p>Example:</p>
<div class="fragment"><div class="line">++afw-local-mode-evaluate:</div>
<div class="line">{</div>
<div class="line">    &quot;ACCEPT&quot;: &quot;application/xml&quot;,    // Use media-type &quot;application/x-afw&quot;</div>
<div class="line">    &quot;syntax&quot;: &quot;template&quot;            // Evaluate request as a template                 </div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md59"></a>
++afw-local-mode-http-like</h3>
<p>Directive <code>++afw-local-mode-http-like</code> indicates that input segments contain a request similar to a subset of an HTTP request. This request is processed by afw in a similar way to how it processes an actual HTTP request, but via an HTTP-like local server implementation.</p>
<p>The &ndash;conf specified on the afw command allow much of the configuration available to an afw HTTP server. If there is not a conf file supplied, a request handler is added for "/" that used the adaptor request handler.</p>
<p>The first line of the request must be an HTTP method name followed by a URI. The remainder of the first line is ignored for now but for possible future enhancements should be "HTTP1.1".</p>
<p>All headers are available as request properties.</p>
<p>Headers "CONTENT_TYPE", "ACCEPT" and "QUERY_STRING" are used if specified. The other headers are ignored. "CONTENT_TYPE" and "ACCEPT" default to "application/json".</p>
<p>Content length is determined by the size of the input request body, not the "CONTENT_LENGTH" header.</p>
<p>Header lines end with a line feed (<br  />
 or 0x0A) or a carriage return line feed (\r<br  />
 or 0x0D0x0A).</p>
<p>The response output also looks similar to an HTTP response.</p>
<p>Example:</p>
<div class="fragment"><div class="line">GET /afw/_AdaptiveDataType_/string HTTP1.1</div>
<div class="line">ACCEPT: &quot;application/xml&quot;</div>
</div><!-- fragment --><p>Response:</p>
<div class="fragment"><div class="line">HTTP/1.1 200 OK</div>
<div class="line">Server: afw_command_local/1.0.0</div>
<div class="line">Date: Sat, 26 Mar 2022 18:12:27 GMT</div>
<div class="line">Content-Type: application/xml</div>
<div class="line"> </div>
<div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div>
<div class="line">&lt;object objectType=&quot;_AdaptiveDataType_&quot;&gt;</div>
<div class="line">    &lt;string name=&quot;brief&quot;&gt;A string&lt;/string&gt;</div>
<div class="line">    &lt;string name=&quot;cType&quot;&gt;afw_utf8_t&lt;/string&gt;</div>
<div class="line">    &lt;string name=&quot;compileType&quot;&gt;error&lt;/string&gt;</div>
<div class="line">    &lt;string name=&quot;dataType&quot;&gt;string&lt;/string&gt;</div>
<div class="line">    &lt;string name=&quot;dataTypeParameterType&quot;&gt;MediaType&lt;/string&gt;</div>
<div class="line">    &lt;string name=&quot;description&quot;&gt;Data type string hold a sequence of Unicode code points as defined at http://www.unicode.org.&lt;/string&gt;</div>
<div class="line">    &lt;boolean name=&quot;directReturn&quot;&gt;false&lt;/boolean&gt;</div>
<div class="line">    &lt;boolean name=&quot;evaluated&quot;&gt;false&lt;/boolean&gt;</div>
<div class="line">    &lt;boolean name=&quot;jsonImpliesDataType&quot;&gt;true&lt;/boolean&gt;</div>
<div class="line">    &lt;string name=&quot;jsonPrimitive&quot;&gt;string&lt;/string&gt;</div>
<div class="line">    &lt;string name=&quot;ldapOid&quot;&gt;1.3.6.1.4.1.1466.115.121.1.15{64512}&lt;/string&gt;</div>
<div class="line">    &lt;boolean name=&quot;relationalCompares&quot;&gt;true&lt;/boolean&gt;</div>
<div class="line">    &lt;boolean name=&quot;scalar&quot;&gt;true&lt;/boolean&gt;</div>
<div class="line">&lt;/object&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md60"></a>
++afw-local-multi-request-properties</h2>
<p>This directive supplies request properties for all subsequent requests using a relaxed JSON UTF-8 encoded object. This object will be available by accessing /afw/_AdaptiveRequest\/current and by using the "request::" qualifier. These properties can be replaced by another ++afw-local-multi-request-properties derivative.</p>
<p>Avoid properties ACCEPT, CONTENT_TYPE, REQUEST_METHOD and REQUEST_URI plus any headers you plan to provide with <code>++afw-local-mode-http-like</code> since they can be overridden by a request.</p>
<p>You can provide other HTTP-like request headers. While running afw &ndash;local, you are running with your access to files and databases. Therefore, since you are limited by your system access, using "fake" headers is a way to test AFW authorization policies.</p>
<p>Example:</p>
<div class="fragment"><div class="line">++afw-local-multi-request-properties:</div>
<div class="line">{</div>
<div class="line">    &quot;REMOTE_USER&quot;: &quot;TheBigBoss&quot;,</div>
<div class="line">    &quot;requestPurpose&quot;: &quot;Example only&quot;,   // Request&#39;s purpose</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Apr 8 2023 19:30:17 for Adaptive Framework by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
